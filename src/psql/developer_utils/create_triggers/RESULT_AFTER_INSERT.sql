




CREATE OR REPLACE FUNCTION RESULT_AFTER_INSERT() RETURNS TRIGGER AS
$$
BEGIN
	UPDATE
		EXPERIMENT
	SET
		TOTAL_TRIALS = TOTAL_TRIALS + 1,
		NET_SCORE = NET_SCORE + NEW.SCORE,
		MEAN_SCORE = (NET_SCORE + NEW.SCORE) / (TOTAL_TRIALS+1)
	WHERE
		ID = NEW.EXPERIMENT_ID;
	RETURN NEW;

END
$$
LANGUAGE PLPGSQL;

CREATE TRIGGER RESULT_AFTER_INSERT AFTER INSERT ON RESULT
FOR EACH ROW
WHEN (PG_TRIGGER_DEPTH() = 0)
EXECUTE PROCEDURE RESULT_AFTER_INSERT();